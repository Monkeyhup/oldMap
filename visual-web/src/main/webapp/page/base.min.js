(function(){Array.prototype.each=function(fn){try{this.i||(this.i=0);if(this.length>0&&fn.constructor==Function){while(this.i<this.length){var e=this[this.i];if(e&&e.constructor==Array){e.each(fn)}else{fn.call(e,e)}this.i++}this.i=null}}catch(ex){}return this};Array.prototype.unique=function(){var arr=this;var obj={};for(var i=0,len=arr.length;i<len;i++){var e=arr[i];obj.e=e}arr.length=0;for(var o in obj){arr.push(o)}return arr};Array.prototype.in_array=function(e){for(var i=0;i<this.length;i++){if(this[i]===e||this[i]==="##"||this[i]===""){return true}}return false};Array.prototype.remove=function(dx){if(isNaN(dx)||dx<0||dx>this.length-1){return}this.splice(dx,1)};Array.prototype.max=function(){if(this.length==0){throw Error("?????0")}var temp=this[0];for(var i=1,len=this.length;i<len;i++){var one=this[i];if(!isNaN(one)&&one>temp){temp=this[i]}}return temp};Number.prototype=Object.defineProperty(Number.prototype,"double",{get:function(){return(this+this)}});Object.defineProperty(Number.prototype,"square",{get:function(){return(this*this)}});Number.prototype.format=function(){var num=this.valueOf()+"";var numStr="";var _len=num.length;var flag=0;for(var i=_len-1;i>=0;i--){var tempStr=num[i]+"";numStr=tempStr+numStr;if(i!=0&&(flag+1)%3===0){numStr=","+numStr}flag++}return numStr};Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))}}return fmt}})();var SGIS=SGIS||{};SGIS.registerNamespace=function(nameSpace){var d=window,c=nameSpace.split(".");for(var b=0;b<c.length;b++){var e=c[b],a=d[e];if(!a){a=d[e]={};a.__namespace=true;a.__typeName=c.slice(0,b+1).join(".")}d=a
}};SGIS.Log=function(msg){if(SGIS.Config.log&&window.console){console.log(msg)}};SGIS.Debug=function(msg,error){};SGIS.PageInfo=function(pageNumber,pageSize){this.pageNumber=pageNumber;this.pageSize=pageSize};SGIS.PageInfo.prototype={getPageNumber:function(){return this.pageNumber},getPageSize:function(){return this.pageSize}};SGIS.Region=function(regionCode,regionName,regionLevel){this.regionCode=regionCode||"";this.regionName=regionName?regionName:"???";this.regionLevel=regionLevel?regionLevel:SGIS.Region.recognitionLevel(this.regionCode)};SGIS.Region.prototype={getName:function(){return this.regionName},getCode:function(){return this.regionCode},getLevel:function(){if(this.regionLevel<0){return SGIS.Region.recognitionLevel(this.getCode())}return this.regionLevel},toString:function(){return this.getName()+"?"+this.getCode()+"#"+this.getLevel()+"?"}};SGIS.Region.isSameLevel=function(region0,region1){return region0.getLevel()==region1.getLevel()};SGIS.Region.recognitionLevel=function(regionCode){if(!regionCode){return 0}var leng=regionCode.length;var regionlevel=1;if(leng==12){if(regionCode.indexOf("00000000")==0){regionlevel=1}else{if(regionCode.toString().substring(2,12)=="0000000000"){regionlevel=2}else{if(regionCode.toString().substring(4,12)=="00000000"){regionlevel=3}else{if(regionCode.toString().substring(6,12)=="000000"){regionlevel=4}else{if(regionCode.toString().substring(9,12)=="000"){regionlevel=5}else{regionlevel=6}}}}}}else{if(leng<=10){regionlevel=9}else{if(leng>12&&leng<=14){regionlevel=7}else{if(leng>14&&leng<=29){regionlevel=8}}}}return regionlevel};SGIS.Region.getPrefixCode=function(regionCode){var re="";var code=regionCode.toString();if(code.indexOf("#")!=-1){return code.substring(0,code.indexOf("#"))}else{if(code.length==12){if(code.lastIndexOf("000000000000")==0){re=code.substring(0,0)}else{if(code.lastIndexOf("0000000000")>=2){re=code.substring(0,2)}else{if(code.lastIndexOf("00000000")>=4){re=code.substring(0,4)}else{if(code.lastIndexOf("000000")>=6){re=code.substring(0,6)
}else{if(code.lastIndexOf("000")>=9){re=code.substring(0,9)}else{re=regionCode}}}}}}else{re=code}}return re};SGIS.Region.isSubRegion=function(reg1,reg2){if(!reg1||!reg2){return false}var prefix1=SGIS.Region.getPrefixCode(reg1);var prefix2=SGIS.Region.getPrefixCode(reg2);if(prefix2.indexOf(prefix1)!=-1){return true}else{return false}};SGIS.Region.getLevelName=function(level){switch(level){case 2:return"?";case 3:return"??";case 4:return"??";case 5:return"????";case 6:return"????";case 7:return"??????";case 8:return"???";case 9:return"????";default:return"?"}};SGIS.Region.getRegionLevelName=function(regionCode){regionCode=regionCode.replace(/_/g,"0");if(regionCode=="000000000000"){return"??"}else{return SGIS.Region.getLevelName(SGIS.Region.recognitionLevel(regionCode))}};SGIS.Region.getSubCode=function(regioncode,regionlevel){switch(regionlevel){case 1:return"";case 2:return regioncode.substring(0,2);case 3:return regioncode.substring(0,4);case 4:return regioncode.substring(0,6);case 5:return regioncode.substring(0,9);case 6:return regioncode.substring(0,12);case 7:return regioncode.substring(0,14);case 8:return regioncode.substring(0,29);case 9:return regioncode.substring(0,10);default:return regioncode}};SGIS.Region.getSub=function(regioncode){var level=SGIS.Region.recognitionLevel(regioncode);return SGIS.Region.getSubCode(regioncode,level)};SGIS.Region.getNextLevels=function(regioncode){var level=SGIS.Region.recognitionLevel(regioncode);if(level==1){return[2,3,4,5,6]}else{if(level==2){if(SGIS.Region.isMunicipality(regioncode)){return[4,5,6]}else{return[3,4,5,6]}}else{if(level==3){return[4,5,6]}else{if(level==4){return[5,6]}else{if(level==5){return[6]}else{if(level==6){return[]}}}}}}return[]};SGIS.Region.getNameByLevel=function(level){switch(level){case 1:return"??";case 2:return"?";case 3:return"?";case 4:return"??";case 5:return"??";case 6:return"?";case 7:return"??";case 8:return"???";case 9:return"???";default:return"?"}};SGIS.Region.getLenByLevel=function(level){var len=0;
switch(level){case 1:len=0;break;case 2:len=2;break;case 3:len=4;break;case 4:len=6;break;case 5:len=9;break;case 6:len=12;break;case 7:len=14;break;case 8:len=29;break;case 9:len=10;break}return len};SGIS.Region.MunicipalRegions=["11","12","31","50"];SGIS.Region.isMunicipality=function(regioncode){var m=SGIS.Region.MunicipalRegions;var prefix=regioncode.substring(0,2);var re=false;for(var i=0,_size=m.length;i<_size;i++){if(prefix==m[i]){re=true;break}}return re};SGIS.Region.filterRegions=function(regions,area){if(SGIS.Config.Macro.escapeRegionControl){return regions}var re=[];if(regions.length==0){alert("????????");return re}var _area=area||uPower.getUserarea();var areaCodess=_area.codes;if(areaCodess.length==0||regions[0].length<12){return regions}for(var i=0;i<areaCodess.length;i++){var codeLength=areaCodess[i].length;for(var j=0;j<regions.length;j++){if(regions[j].getCode().substr(0,codeLength)==areaCodess[i]){re.push(regions[j])}}}if(re.length==0){alert("??????????????\n?????"+_area.names.join("?")+"????")}return re};SGIS.Region.toStandardCode=function(prefix){while(prefix.length<12){prefix=prefix+"0"}return prefix};SGIS.Region.padRight=function(prexCode,len,c){if(len<prexCode.length){return prexCode}var a=[];for(var i=0,size=len-prexCode.length;i<size;i++){a.push(c)}return prexCode+a.join("")};SGIS.Region.createXXRegion=function(parcode,itsLevel,targetLevel){var strIts=SGIS.Region.padRight(SGIS.Region.getSubCode(parcode,itsLevel),SGIS.Region.getLenByLevel(itsLevel+1),"#");var targetStr=SGIS.Region.padRight(strIts,SGIS.Region.getLenByLevel(targetLevel),"*");var newcode=SGIS.Region.padRight(targetStr,12,"0");return new SGIS.Region(newcode,"??"+SGIS.Region.getNameByLevel(targetLevel),targetLevel)};SGIS.Util={getBaseUrl:function(){var loc=window.location;if(loc.origin){return loc.origin}return loc.protocol+"//"+loc.host},getLocalPath:function(){var location=document.location.toString();var contextPath="";if(location.indexOf("://")!=-1){contextPath+=location.substring(0,location.indexOf("//")+2);
location=location.substring(location.indexOf("//")+2,location.length)}var index=location.indexOf("/");contextPath+=location.substring(0,index+1);location=location.substring(index+1);index=location.indexOf("/");contextPath+=location.substring(0,index+1);return contextPath},getLocalhref:function(){var _lochref=location.href;var indexlast=0;var rhraf="";if(_lochref){indexlast=_lochref.lastIndexOf("/");if(indexlast!=0){rhraf=_lochref.substring(0,indexlast+1)}}return rhraf},getParamFromURL:function(url){var s=url||location.href,re=new SGIS.Util.Hashtable();var kvs=s.split("?")[1]?s.split("?")[1].split("&"):[];for(var i=0,_sizei=kvs.length;i<_sizei;i++){var o=kvs[i].split("=");re.add(o[0],decodeURIComponent(o[1]))}return re},downloadData:function(id,src){var ifrdownload=top.$("#"+id);ifrdownload.css("display","block");ifrdownload.attr("src",src);ifrdownload.css("display","none")},formatString:function(source,opts){source=String(source);var data=Array.prototype.slice.call(arguments,1),toString=Object.prototype.toString;if(data.length){data=data.length==1?(opts!==null&&(/\[object Array\]|\[object Object\]/.test(toString.call(opts)))?opts:data):data;return source.replace(/\{\{(.+?)\}\}/g,function(match,key){var replacer=data[key];if("[object Function]"==toString.call(replacer)){replacer=replacer(key)}return("undefined"==typeof replacer?"":replacer)})}return source}};SGIS.Util.Hashtable=function(){this._hash={}};SGIS.Util.Hashtable.prototype={add:function(key,value){if(typeof(key)!="undefined"){if(this.contains(key)==false){this._hash[key]=typeof(value)=="undefined"?null:value;return true}else{return false}}else{return false}},update:function(key,value){if(typeof key!="undefined"){this._hash[key]=typeof(value)=="undefined"?null:value;return true}else{return false}},remove:function(key){var re=this._hash[key];delete this._hash[key];return re},count:function(){var i=0;for(var k in this._hash){i++}return i},items:function(key){return this._hash[key]},contains:function(key){return typeof(this._hash[key])!="undefined"
},clear:function(){for(var k in this._hash){delete this._hash[k]}},keys:function(){var re=[];for(var k in this._hash){re.push(k)}return re},each:function(handler){if(!jQuery.isFunction(handler)){return}for(var k in this._hash){handler(this._hash[k],k)}},toArray:function(){var re=[];for(var k in this._hash){re.push(this._hash[k])}return re},addAll:function(arr,each){for(var i=0;i<arr.length;i++){var item=each.call(this,arr[i]);item&&this.add(item[0],item[1])}}};SGIS.Util.Hashtable.fromObject=function(obj){var re=new SGIS.Util.Hashtable();re._hash=obj;return re};SGIS.Util.Set=function(){this._hash=new SGIS.Util.Hashtable()};SGIS.Util.Set.prototype={add:function(key){this._hash.add(key,true)},remove:function(key){this._hash.remove(key)},count:function(){return this._hash.count()},clear:function(){this._hash.clear()},each:function(handler){for(var k in this._hash._hash){handler(k)}}};(function(){var _now=function(){return Date.now||function(){return new Date().getTime()}};SGIS.Util.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:new Date().getTime();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=_now();if(!previous&&options.leading===false){previous=now}var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else{if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}}return result}};SGIS.Util.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}};return function(){context=this;args=arguments;timestamp=_now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait)
}if(callNow){result=func.apply(context,args);context=args=null}return result}}})();(function(){var SERVICE_NAME="/visdata/";var WEB_NAME="/visual/";var BASE=(function(){var loc=window.location;if(loc.origin){return loc.origin}return loc.protocol+"//"+loc.host})();var Req=function(api){this.api=api;this.method="GET";this.dataType="json";this._data=null;this._stringify=null;this.contentType=null;this._debug=false;this.serverName=SERVICE_NAME};Req.prototype={_method:function(method){this.method=method;return this},data:function(data){if($.type(data)=="string"){this.contentType="application/json";this._stringify=data}else{this._data=data}return this},json:function(callback,error){_go(this,callback,error)},xml:function(callback){this.dataType="xml";_go(this,callback)},text:function(callback){this.dataType="text";_go(this,callback)},debug:function(){this._debug=true;return this}};var _go=function(req,callback,error){var ajax={url:BASE+SGIS.API.serverName+req.api+"?_method="+req.method,type:"POST",data:req._data,dataType:req.dataType,success:function(re){if(req.api.indexOf("oAuth")<0){if(re&&re.power&&re.power=="overdue"){if(confirm(re.info+" ??????")){LoginMod.init();LoginMod.show()}else{SGIS.Util.goToLogin();return}}}callback&&callback(re)},error:function(re){SGIS.Debug("API????");error&&error(re)}};if(req.contentType){ajax.contentType=req.contentType;ajax.url+=req._data?("&"+$.param(req._data)):"";ajax.data=req._stringify}if(req._debug){alert(ajax.url+" "+ajax.type)}$.ajax(ajax)};var createReq=function(args){var url=args[0].replace(/\./g,"/");var data=Array.prototype.slice.call(args,1);if(data.length){var i=0;url=url.replace(/\?/g,function(){return data[i++]})}return new Req(url)};SGIS.API={serverName:SERVICE_NAME,get:function(url){return createReq(arguments)._method("GET")},post:function(url){return createReq(arguments)._method("POST")},del:function(url){return createReq(arguments)._method("DELETE")},put:function(url){return createReq(arguments)._method("PUT")},getURL:function(url){return BASE+SERVICE_NAME+createReq(arguments).api
},setServerName:function(_name){this.serverName="/"+_name+"/"}};SGIS.URL={get:function(url){return BASE+WEB_NAME+url},SEAJS_BASE:BASE+WEB_NAME+"lib/module"}})();(function(){var templateSettings={evaluate:/\{%([\s\S]+?)%\}/g,interpolate:/\{\{(.+?)\}\}/g,escape:/\{\{-([\s\S]+?)\}\}/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;SGIS.Util.template=function(text,data,settings){var render;settings=$.extend({},settings,templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable){source="with(obj||{}){\n"+source+"}\n"}source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj",source)}catch(e){e.source=source;throw e}if(data){return render(data)}var template=function(data){return render.call(this,data)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template}})();(function(){var DEFAULT_TEMP="load";var create=function(container,actions,lazyCall){actions=actions||{};var tree=new dhtmlXTreeObject(container,"100%","100%","tree0");tree.enableDragAndDrop("temporary_disabled");tree.setImagePath(SGIS.Config.DhtmlxImagePath+"imgs/csh_vista/");tree.setOnDblClickHandler(actions.onDbClick||$.noop);tree.setOnCheckHandler(actions.onCheck||$.noop);tree.attachEvent("onClick",typeof(actions)=="function"?actions:(actions.onClick||$.noop));
if(lazyCall){tree.__lazyCall=lazyCall;tree.setOnOpenEndHandler(function(id){var _req=tree.__lazyCall.call(tree,tree,id);_openEnd.apply(tree,[_req,id,tree])})}return tree};var loadXml=function(dhxO,xml){try{dhxO.loadXMLString(xml)}catch(e){SGIS.Log(e)}};var _openEnd=function(req,id,_tree){var isLoaded=_tree.getSubItems(id).indexOf(DEFAULT_TEMP)<0;var hasMoreChild=_tree.hasChildren(id)>1;if(hasMoreChild||isLoaded){return}else{_tree.loadXML(req);_tree.deleteChildItems(id)}};SGIS.Tree={create:function(container,xml,actions,lazyCall){var tree=create(container,actions,lazyCall);loadXml(tree,xml);return tree},createCheckableTree:function(container,xml,actions,lazyCall){var tree=create(container,actions,lazyCall);tree.enableCheckBoxes(1);tree.enableThreeStateCheckboxes(true);loadXml(tree,xml);return tree}}})();(function(){SGIS.Grid={create:function(container){var grid=new dhtmlXGridObject(container);grid.setImagePath(SGIS.Config.DhtmlxImagePath+"imgs/");grid.setSkin("dhx_skyblue");grid.setEditable(false);return grid}}})();SGIS.UI={windowResize:function(){},openWindow:function(pageUrl,width,height,args){var url=pageUrl,sFeatures="dialogWidth={{width}}px;dialogHeight={{height}}px;scroll=no;status=no;resizable=no;";url+=args?"?"+$.param(args):"";window.showModalDialog(url,self,SGIS.Util.formatString(sFeatures,{height:height,width:width}))}};SGIS.UI.delayHover=function(el,enter,leave,delay){var o=typeof el==="string"?$("#"+o):el;var isOver,isShow,timeid;return o.hover(function(){isOver=true;clearTimeout(timeid);if(isShow){return}else{isShow=true;enter.call(this)}},function(){timeid=setTimeout(function(){isOver=isShow=false;leave.call(this)},delay||500)})};(function(){var Op=function(value,text){this.value=value;this.text=text};var create=function(values,texts){var re=[];for(var i=0,_sizei=values.length;i<_sizei;i++){re.push("<option value='"+values[i]+"'>"+texts[i]+"</option>")}return re.join("")};SGIS.UI.Option={createMonth:function(){var v=[],t=[];for(var i=0;i<12;i++,v.push(i),t.push(i+"?")){}return create(v,t)
},createSeason:function(){return create("1,2,3,4".split(","),"???,???,???,???".split(","))},createYear:function(start,end){var currentYear=new Date().getFullYear(),v=[],t=[];for(var i=0;i<10;i++){v.push(currentYear-i);t.push((currentYear-i)+"?")}return create(v,t)},create:function(values,names){}}})();(function(){var loading='<div class="ui active inverted dimmer"> <div class="ui text loader">?????</div> </div >';var _getNode=function(msg,selector){var _context=selector||"body";var $loading=$(".ui.inverted.dimmer",_context);$loading.length||($loading=$(loading).appendTo(_context));msg&&$loading.find(".text").text(msg);return $loading};SGIS.UI.addLoadingBar=function(msg,selector){_getNode(msg,selector).addClass("active")};SGIS.UI.clearLoadingBar=function(selector){_getNode(null,selector).removeClass("active")}})();(function(){var $backdrop;var $loading;var loading="<div class='loading dimmer' style='cursor: wait;z-index:1999;'>"+"<span class='text alert alert-info'>{{text}}</span></div>";var _getNode=function(text,selector){var _context=selector||"body";var $loading=$(".loading",_context);if($loading.length>0){$loading.find("span").html(text||"????...")}$loading.length||($loading=$(loading.replace("{{text}}",!text?"????...":text)).appendTo(_context));return $loading};SGIS.UI.addLoadingBar0=function(text,selector){_getNode(text,selector).addClass("active")};SGIS.UI.clearLoadingBar0=function(selector){_getNode(null,selector).removeClass("active")}})();(function(){var $backdrop;var $loading;var loading="<div style='cursor: wait;z-index:1999;position: relative;top: 20px;bottom: 20px;width: 100%'>"+"<span class='text alert alert-info'>{{text}}</span></div>";var _getNode=function(text,selector){var _context=selector||"body";var $loading=$(".loading",_context);if($loading.length>0){$loading.find("span").html(text||"????...")}$loading.length||($loading=$(loading.replace("{{text}}",!text?"????...":text)).appendTo(_context));return $loading};SGIS.UI.addLoadingBar1=function(text,selector){_getNode(text,selector).addClass("active")
};SGIS.UI.clearLoadingBar1=function(selector){_getNode(null,selector).removeClass("active")}})();(function(){var $backdrop;var $loading;var alert='<div class="alert alert-warning fade in" role="alert">{{info}}</div>';var alertWithClose='<div class="alert alert-warning alert-dismissible" role="alert">'+'<button type="button" class="close" data-dismiss="alert">'+'<span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'+"{{info}}</div>";var _getNode=function(info,type,selector,withclose){var _context=selector||"body";var $_refer=$(_context);if($(_context).hasClass("modal")){$_refer=$(_context).find(".modal-content")}var offset=$_refer.offset();var h=$_refer.height();var w=$_refer.width();var top=offset.top+h/2-50;var left=offset.left+w/2-50;var className="alert-warning";if(type=="success"){className="alert-success"}if(type=="dange"){className="alert-dange"}if(type=="warn"){className="alert-warning"}if(type=="info"){className="alert-info"}var $alert=$("."+className,_context);$alert.remove();var str=!withclose?alert:alertWithClose;$alert=$(str.replace("{{info}}",!info?"":info)).addClass(className).css({position:"absolute",top:top+"px",left:left+"px","z-index":"99999999999999999999"}).appendTo(_context);return $alert};SGIS.UI.alert=function(info,type,selector,time,withclose){var alertObj=_getNode(info,type,selector,withclose);alertObj.alert();if(!withclose){setTimeout(function(){alertObj.alert("close")},time||3000)}};SGIS.UI.alert0=function(info,type,selector){var alertObj=_getNode(info,type,selector,true);alertObj.alert()}})();SGIS.registerNamespace("SGIS.AutoForm");(function(){var Validator={notnull:function(v,args){return v!=""},number:function(v,args){return !isNaN(v)},len:function(v,args){},min:function(v,args){return v.length>args},max:function(v,args){return v.length<args&&v.length>0},regx:function(v,args){return new RegExp(args).test(v)}};var Msg={notnull:"????",number:function(v,args){return !isNaN(v)},len:function(v,args){},min:function(v,args){return v.length>args
},max:function(v,args){return v.length<args&&v.length>0},regx:function(v,args){return new RegExp(args).test(v)}};var testV=function(){var $this=$(this),vs=$this.attr("data-validation").split(";"),result=true;for(var i=0,_sizei=vs.length;i<_sizei;i++){var keys=vs[i].split(",");result=Validator[keys[0]]?Validator[keys[0]].call(this,$this.val(),keys[1]):true;if(!result){break}}$this.parentsUntil(".control-group").parent().toggleClass("error",!result);return result};SGIS.AutoForm=function(content,options){this.options=options;this.$element=$(content);this.$element.delegate(":input[data-validation]","blur",testV)};SGIS.AutoForm.prototype={validation:function(){var re=true;this.$element.find("input[data-validation]").each(function(){if(!testV.call(this)){re=false}});return re},submit:function(url,callback){if(this.validation()){var ps=this.$element.serializeArray(),o={};for(var i=0,_sizei=ps.length;i<_sizei;i++){o[ps[i].name]=ps[i].value}$.post(url,o,function(re){callback&&callback.call(this,re)},this.options.type||"text")}},reset:function(){this.$element[0].reset()},setInitValue:function(data){for(var key in data){this.$element.find("[name='"+key+"']").val(data[key])}},serializeObject:function(){var o={};var a=this.$element.serializeArray();$.each(a,function(){var n=this.name.split(".");if(n.length==1){if(o[this.name]){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||"")}else{o[this.name]=this.value||""}}else{if(n.length==2){o[n[0]]={};o[n[0]][n[1]]=this.value||""}}});return o},find:function(selector){return this.$element.find(selector)}};SGIS.AutoForm.UploadAction=function(formid,iframeid,fileType,onSuccess){var reg=/xls/g,form=$("#"+id),iframe=$("#"+iframeid);iframe.one("load",function(){})};SGIS.AutoForm.getDoc=function(frame){var doc=null;try{if(frame.contentWindow){doc=frame.contentWindow.document}}catch(err){SGIS.Log("cannot get iframe.contentWindow document: "+err)}if(doc){return doc}try{doc=frame.contentDocument?frame.contentDocument:frame.document
}catch(err){SGIS.Log("cannot get iframe.contentDocument: "+err);doc=frame.document}return doc};SGIS.AutoForm.UploadAction=function(formid,iframeid,fileType,onSuccess){var reg=/xls/g,form=$("#"+id),iframe=$("#"+iframeid);iframe.one("load",function(){})}})();(function(){if(!$.fn.Drag){$.fn.Drag=function(){var M=false;var Rx,Ry;var t=$(this);var head=t.find(".move");head.mousedown(function(event){Rx=event.pageX-(parseInt(t.css("left"))||0);Ry=event.pageY-(parseInt(t.css("top"))||0);$("div.drag").css("z-index",1999);t.css("z-index",2000);t.css("position","absolute").fadeTo(20,1);t.find(".move").css("cursor","move");M=true}).mouseup(function(event){M=false;t.fadeTo(20,1)});$(document).mousemove(function(event){if(M){t.css({top:event.pageY-Ry,left:event.pageX-Rx});var $tooltip=$("#map-container >#thematic-tooltip");if($tooltip.length>0){$tooltip.remove()}}})}}})();(function(){SGIS.BASE_URL=SGIS.Util.getLocalPath()})();SGIS.Config={DhtmlxImagePath:SGIS.BASE_URL+"lib/dhtmlx/",log:true};var checkAgent=function(){var agent=navigator.userAgent.toLowerCase();var ind=agent.indexOf("android");var indip=agent.indexOf("iphone");var indipad=agent.indexOf("ipad");if(ind>0||indip>0||indipad>0){SGIS.agent="client"}else{SGIS.agent="pc"}};checkAgent();
